<html>
<script type='text/javascript' src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
<link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css' integrity='sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB' crossorigin='anonymous'>
<!-- <script type= 'text/javascript' src='../../controlador/JS/calendario.js'></script> -->
<script type='text/javascript' src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
<meta charset='UTF-8' />
  <body>
    <button id='denuncias'>Denuncias</button>
    <div id="contDenuncias"></div>
    </body>
</html>
<script>

$("#denuncias").on("click", function(){
  $(".quitar").remove();
  denuncia();
});

function mostrar_publid(respuesta){
  for (let i in respuesta ){
    let autor = $("<div class='quitar'>"+respuesta[i].id_autor+"</div><button autor ='"+respuesta[i].id_autor+"'publi='"+respuesta[i].id_publicacion+"' class='quitar' value = 'quitarD'>Eliminar Denuncia</button><button autor ='"+respuesta[i].id_autor+"'publi='"+respuesta[i].id_publicacion+"' class='quitar' value = 'eliminarD'>Eliminar Publicación</button>");
    autor.appendTo("#contDenuncias");
    console.log(respuesta[i].id_autor);
    console.log(respuesta[i].id_publicacion);
  }
}

function denuncia(){
  let request = new XMLHttpRequest();
  request.onreadystatechange = function (){
    if (this.readyState === 4 && this.status == 200)
      var denuncias = JSON.parse(this.response);
      mostrar_publid(denuncias);
  }
  request.open("POST", "../../modelo/PHP/obtener_denuncia.php");
  request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  request.send();
}

function quitar_eliminar( ruta, autor_publi, id_publi, mensaje){
  jQuery.ajax({
      url:"../../modelo/PHP/"+ruta+".php",
      data:{
          usuario : autor_publi,
          publi : id_publi
      },
      type: "POST",
      success: function(response){
          alert("¡Proceso Éxitoso!, la "+mensaje+" ha sido eliminada");
      }
  });
}

document.getElementById("contDenuncias").addEventListener("click",()=>{
  let denun = event.target.value;
  let publi = event.target.getAttribute("publi");
  let autor = event.target.getAttribute("autor");
  if (denun = "quitarD")
    quitar_eliminar("quitar_denuncia",autor,publi,"denuncia");
  else if (denun = "eliminarD")
    quitar_eliminar("eliminar_publicacion", autor, publi, "publicación");
  $(".quitar").remove();
  denuncia();
});

</script>
